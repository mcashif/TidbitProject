<!DOCTYPE HTML>
{% load staticfiles %}
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <title>SlickGrid example: Explicit grid initialization</title>

  <link rel="stylesheet" href="{% static 'slickg/slick.grid.css' %}" type="text/css"/>
  <link rel="stylesheet" href="{% static 'slickg/controls/slick.pager.css' %}" type="text/css"/>
  <link rel="stylesheet" href="{% static 'slickg/css/smoothness/jquery-ui-1.8.16.custom.css' %}" type="text/css"/>
  <link rel="stylesheet" href="{% static 'slickg/controls/slick.columnpicker.css' %}" type="text/css"/>
  <link rel="stylesheet" href="{% static 'slickg/examples/examples.css' %}" type="text/css"/>

  <style>

      .slick-headerrow-column {
      background: #87ceeb;
      text-overflow: clip;
      -moz-box-sizing: border-box;
      box-sizing: border-box;
    }
    .slick-headerrow-column input {
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100%;
      -moz-box-sizing: border-box;
      box-sizing: border-box;
    }

    .cell-effort-driven {
      text-align: center;
    }

    .slick-group-title[level='0'] {
      font-weight: bold;
    }

    .slick-group-title[level='1'] {
      text-decoration: underline;
    }

    .slick-group-title[level='2'] {
      font-style: italic;
    }
  </style>

</head>
<body>

  <div style="position:relative">
    <div style="width:600px;">
      <div class="grid-header" style="width:100%">
        <label>Santa's TODO list:</label>
      </div>
      <div id="myGrid" style="width:100%;height:500px;"></div>
    </div>
  </div>

<script src="{% static 'slickg/lib/firebugx.js' %}"></script>
<script src="{% static 'slickg/lib/jquery-1.7.min.js' %}"></script>
<script src="{% static 'slickg/lib/jquery-ui-1.8.16.custom.min.js' %}"></script>
<script src="{% static 'slickg/lib/jquery.event.drag-2.2.js' %}"></script>
<script src="{% static 'slickg/slick.core.js' %}"></script>
<script src="{% static 'slickg/slick.formatters.js' %}"></script>
<script src="{% static 'slickg/slick.editors.js' %}"></script>
<script src="{% static 'slickg/plugins/slick.cellrangedecorator.js' %}"></script>
<script src="{% static 'slickg/plugins/slick.cellrangeselector.js' %}"></script>
<script src="{% static 'slickg/plugins/slick.cellselectionmodel.js' %}"></script>
<script src="{% static 'slickg/slick.grid.js' %}"></script>
<script src="{% static 'slickg/slick.groupitemmetadataprovider.js' %}"></script>
<script src="{% static 'slickg/slick.dataview.js' %}"></script>
<script src="{% static 'slickg/controls/slick.pager.js' %}"></script>
<script src="{% static 'slickg/controls/slick.columnpicker.js' %}"></script>
<script src="{% static 'slickg/slick.editors.js' %}"></script>
<script src="{% static 'slickg/plugins/slick.rowmovemanager.js' %}"></script>
<script src="{% static 'slickg/plugins/slick.rowselectionmodel.js' %}"></script>

<script>
  var grid;
  var dataView;
  var data = [];
  var columnFilters = {};
  var columns = [

    {id: "sel", name: "#", field: "num", cssClass: "cell-selection", width: 40, resizable: false, selectable: false, focusable: false },
    {id: "sh", name: "Sheet", field: "sheet", width: 60, minWidth: 50, cssClass: "cell-title", sortable: true, editor: Slick.Editors.Text},
    {id: "is", name: "Cell ID", field: "cid", width: 60, minWidth: 50, cssClass: "cell-title", sortable: true, editor: Slick.Editors.Text},
    {id: "tlab", name: "Top Label", field: "topLabel", width: 80, sortable: true, editor: Slick.Editors.Text},
    {id: "llab", name: "Left Label", field: "leftLabel", width: 80, sortable: true, editor: Slick.Editors.Text},
    {id: "frm", name: "Formula", field: "formula", minWidth: 150, sortable: true},
    {id: "val", name: "Value", field: "value", minWidth: 150, sortable: true}

    ];

    var options = {
      enableCellNavigation: true,
      showHeaderRow: true,
      headerRowHeight: 30,
      editable: true
    };

    function filter(item) {
    for (var columnId in columnFilters) {
      if (columnId !== undefined && columnFilters[columnId] !== "") {
        var c = grid.getColumns()[grid.getColumnIndex(columnId)];
        if (item[c.field] != columnFilters[columnId]) {
          return false;
        }
      }
    }
    return true;
  }

    function groupBySheet() {
      dataView.setGrouping({
        getter: "sheet",
        formatter: function (g) {
          return g.value + "  <span style='color:green'>(" + g.count + " items)</span>";
        },

      });
    }

    function loadData() {

      data = [];

      {% for sdata in listofdData %}

        var i={{ forloop.counter }}
        data[i-1] = {

          {% if sdata.0 == 0 %}
          id:  "id_" + i,
          num:  i,
          sheet:  "{{sdata.1}}",
          cid: "{{sdata.2}}",
          topLabel: "{{sdata.4}}",
          leftLabel: "{{sdata.5}}",
          formula: "No Formula",
          value:  "{{sdata.3}}"
          {% endif %}

          {% if sdata.0 == 1 %}
          id:  "id_" + i,
          num:  i,
          sheet:  "{{sdata.1}}",
          cid: "{{sdata.2}}",
          topLabel: "{{sdata.5}}",
          leftLabel: "{{sdata.6}}",
          formula: "{{sdata.3}}",
          value:  "{{sdata.4}}"
          {% endif %}

        };

      {% endfor %}

      dataView.setItems(data);
    }



    $(".grid-header .ui-icon")
        .addClass("ui-state-default ui-corner-all")
        .mouseover(function (e) {
          $(e.target).addClass("ui-state-hover")
        })
        .mouseout(function (e) {
          $(e.target).removeClass("ui-state-hover")
        });

    $(function () {
      var groupItemMetadataProvider = new Slick.Data.GroupItemMetadataProvider();
      dataView = new Slick.Data.DataView({
        groupItemMetadataProvider: groupItemMetadataProvider,
        inlineFilters: true
      });
      grid = new Slick.Grid("#myGrid", dataView, columns, options);

      // register the group item metadata provider to add expand/collapse group handlers
      grid.registerPlugin(groupItemMetadataProvider);
      grid.setSelectionModel(new Slick.CellSelectionModel());

      var pager = new Slick.Controls.Pager(dataView, grid, $("#pager"));
      var columnpicker = new Slick.Controls.ColumnPicker(columns, grid, options);


      // wire up model events to drive the grid
      dataView.onRowCountChanged.subscribe(function (e, args) {
        grid.updateRowCount();
        grid.render();
      });

      dataView.onRowsChanged.subscribe(function (e, args) {
        grid.invalidateRows(args.rows);
        grid.render();
      });

      $(grid.getHeaderRow()).delegate(":input", "change keyup", function (e) {
        var columnId = $(this).data("columnId");
        if (columnId != null) {
          columnFilters[columnId] = $.trim($(this).val());
          dataView.refresh();
        }
      });

      grid.onHeaderRowCellRendered.subscribe(function(e, args) {
          $(args.node).empty();
          $("<input type='text'>")
             .data("columnId", args.column.id)
             .val(columnFilters[args.column.id])
             .appendTo(args.node);
      });

      // initialize the model after all the events have been hooked up
      dataView.beginUpdate();
      loadData();
      groupBySheet();
      dataView.setFilter(filter);
      dataView.endUpdate();

      $("#gridContainer").resizable();

    })
    </script>

</body>
</html>
